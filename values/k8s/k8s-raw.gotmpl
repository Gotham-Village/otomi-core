{{- $v := .Environment.Values }}
{{- $t := $v.teamConfig }}
{{- range $team := $t.teams }}
{{- end }}
resources:
  {{- range $ns := $v.k8s.namespaces }}
  - apiVersion: v1
    kind: Namespace
    metadata:
      name: {{ $ns.name }}
      labels:
        name: {{ $ns.name }}
        istio-injection: {{ if $ns | getOrNil "disableIstioInjection" }}disabled{{ else }}enabled{{ end }}
  {{- end }}
  {{- range $team := $t.teams }}
  {{- $ns := printf "team-%s" $team.name }}
  - apiVersion: v1
    kind: Namespace
    metadata:
      name: {{ $ns }}
      labels:
        name: {{ $ns }}
  {{- end }}
  {{- range $ns := list "ingress" "system" }}
  - apiVersion: v1
    data:
      .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL2V1Lmdjci5pbyI6eyJ1c2VybmFtZSI6Il9qc29uX2tleSIsInBhc3N3b3JkIjoie1xuICBcInR5cGVcIjogXCJzZXJ2aWNlX2FjY291bnRcIixcbiAgXCJwcm9qZWN0X2lkXCI6IFwiazhzLXBsYXlncm91bmQtMjU2MTEzXCIsXG4gIFwicHJpdmF0ZV9rZXlfaWRcIjogXCI2M2ZmM2FjNDU5NjgwZDI4N2RjZWVkYmFiNWFlZjljMTQwYzU2OWE1XCIsXG4gIFwicHJpdmF0ZV9rZXlcIjogXCItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUURRU29XZllXb3A4bVlxXFxucG1UNU9HZTMwaURzQnBaYlRuV04xYXNpdDFreHQ1YkozZUhJeTRpdW5DRHhPeWJMRkVmMXNSN2JKRmtuNnZvQ1xcbmFsS3pHODVIeEs3c21tQ2ttVWJramhSNSthcjYwS2JVRi8wWFdrekk3SHlGY214N1EreW9laTRJaGs5QS9zcGJcXG53VHJya1RSYkt5UjRFUkxMOWRhdGhublZSdmgxT1ZkQzM4RVFNSHp6ZkRZUldDak1QTDY1aWc2TlhzNTNoZktMXFxucDlWOGh4OFlQZHBTT1luSnpWRTRHdkZ6UUthV0xqWWpxSWVaaVlVZmZ5Vy9qRzNCMEIyczNtdjVuditoRVN1YVxcbjArNjVqMVN4aVAvSXd4cktyOEIxUlpHbVVrSGpJWGJ5NVY4Q1VkVU1Yd3NjMWpNblU0Mmh6L1VFOXRPRm1qc0pcXG5sL3VvWXFOYkFnTUJBQUVDZ2dFQVVRMTJ3dWNXOTF5K3VnRUhFTjRNcWtEb0U4Q2FlTXhtdlRzMHZhMG9WY3J4XFxuci9zYU5kZFNDRlIwRXpzbjVPV3UvT0lnTmptR1FoelRqZVlPNldpOEZEeHFyMktCa2Z1ZFZTb2V1THBaZVFHQlxcbnNjM2w3RlQweFVrVlNaNlZyVC9vMDBTOExoQUp2aXFIMXoyeHJtSlNROW5kZHFWNk1Za29NVjAvZ3FsNzNLMHdcXG5HS2NtaWZyalM0UGRjTXdvZWFJM05KZHlmVTU1R3FMVHFraDJtaUZDWlFXV01sOWlEc0dqdDhZN2pXWVJxZ2JOXFxuVnBYc1dFdGpWYTZ5WURRb0dvbkwxWjZxTHMzcW14RGZrUHdQTGJPSVBkclB4NGZQU3FtY1RFWmNld3VieUJhNVxcbjhOM1h6QnRzWVJDTllORzZ5K01rd05IUk5JRU8vYi9JcTBBalJiYVgwUUtCZ1FEem9aZ2J4ODB0WE9xSm40aUpcXG5PZ2lwV3VtZWJaS2NmTjF0ZVZRanVBT0tQQm9CSVNTNGtIdnZUSjZMOWVxSFllTXloMVUwQ01DUWtTVlREdFNwXFxuYzg0NmJqczBvVnlNekQ3Q0hwcmMyMDloV05Cb0dsS3lyZFNXQlQ5ZVplSDF2TGJMQllNNTRnSGVaWWI2d3hJcVxcbmxjejc3c0tEZjlnTDFGTHg2RFIyV1YyZDBRS0JnUURhM1o5Sm1pOXBGTXNOZG1NeFVESDAvUDBDZm4rcUpwWVdcXG5Ld2psU3Y0WHhBTnBwYld2aDNmMFpNSWZyV25PWlVLRjZ3WEpiQmtSc2tNbjlnZ1FoeStuTzJGU2U4SS9CakgyXFxuODFDMEExcWdzL1Azb044Y0x3NXhBelZNQ1h2RWs2WEtuUHY5UTlDNzZ3eW81ZDVHK3VDa0NpWUZsS2dpR28vS1xcbjZoUjlVSkVkYXdLQmdRQ2dFOXd5M0t3bWt6ZVRwNXY1dG9UOGFieTRtUHhORUFvWnBTK3dySGErL0ZDRnozWW1cXG5RdUQ3MGRjVzFVVDlJVWM3NndvRHY0QnZQTDlPZko4a20rKzBHcnVTRURnVVZ4c2hSeVN2MnZXa1c4dkxxd2dOXFxuV1FRbWNsbzV0eTJwM2c0cEJYMDhxaEJhUlZGVU1Kb2VHd0Z0dzJwUkpzNFlyN0MwTzhORXcrRXNFUUtCZ0JwM1xcblZFeTlOV0I2b0RkSGlxVXE4bStTckRIQ0JFUWFHR29qMkJhS0pBSFJ0U3Z3V3ZFWDY1eUZGcWhuK3ZSM2NEenJcXG5kNjZzd0xkUUhDalg2bys5R1RrYXlDRUdVQzM0M00vbENteEtQNHBSV0g0b1dQSjZpaitHU01xaUZ2SmxmRlhzXFxuOTlmZmZIMU01aUlDY2dlWlROTHBXMEd2Z1VsbWR0N3R3WDZKNEpKekFvR0JBTm0rRlJ2TFg3VklhRVA4UHUzZVxcbkxOWmlYZlJxZW80SjVZTDZUR0tjMW5iZHJHdElOUWl2alZNdHZFTFo2cTl1N0ViVjdPSTBGQ3I3dDlsejZIOG5cXG5xU1g3ait4eDBMYjk2OHRoTzhaRUQzcFFJRXN3UUNvNTlveUk0akxzK0xIS2ROZzRjenZGbGI1bU1xbTcyQXNTXFxuTktBVnM5eFVSQUlxUjFmUHYvZG9mVExZXFxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxcblwiLFxuICBcImNsaWVudF9lbWFpbFwiOiBcImdjci1hdXRoLXJvQGs4cy1wbGF5Z3JvdW5kLTI1NjExMy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbVwiLFxuICBcImNsaWVudF9pZFwiOiBcIjExNDU0MjM5OTY5ODg0OTM4MjA1NVwiLFxuICBcImF1dGhfdXJpXCI6IFwiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGhcIixcbiAgXCJ0b2tlbl91cmlcIjogXCJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlblwiLFxuICBcImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybFwiOiBcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0c1wiLFxuICBcImNsaWVudF94NTA5X2NlcnRfdXJsXCI6IFwiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS9nY3ItYXV0aC1ybyU0MGs4cy1wbGF5Z3JvdW5kLTI1NjExMy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbVwiXG59IiwiYXV0aCI6IlgycHpiMjVmYTJWNU9uc0tJQ0FpZEhsd1pTSTZJQ0p6WlhKMmFXTmxYMkZqWTI5MWJuUWlMQW9nSUNKd2NtOXFaV04wWDJsa0lqb2dJbXM0Y3kxd2JHRjVaM0p2ZFc1a0xUSTFOakV4TXlJc0NpQWdJbkJ5YVhaaGRHVmZhMlY1WDJsa0lqb2dJall6Wm1ZellXTTBOVGsyT0RCa01qZzNaR05sWldSaVlXSTFZV1ZtT1dNeE5EQmpOVFk1WVRVaUxBb2dJQ0p3Y21sMllYUmxYMnRsZVNJNklDSXRMUzB0TFVKRlIwbE9JRkJTU1ZaQlZFVWdTMFZaTFMwdExTMWNiazFKU1VWMlowbENRVVJCVGtKbmEzRm9hMmxIT1hjd1FrRlJSVVpCUVZORFFrdG5kMmRuVTJ0QlowVkJRVzlKUWtGUlJGRlRiMWRtV1ZkdmNEaHRXWEZjYm5CdFZEVlBSMlV6TUdsRWMwSndXbUpVYmxkT01XRnphWFF4YTNoME5XSktNMlZJU1hrMGFYVnVRMFI0VDNsaVRFWkZaakZ6VWpkaVNrWnJialoyYjBOY2JtRnNTM3BIT0RWSWVFczNjMjF0UTJ0dFZXSnJhbWhTTlN0aGNqWXdTMkpWUmk4d1dGZHJla2szU0hsR1kyMTROMUVyZVc5bGFUUkphR3M1UVM5emNHSmNibmRVY25KclZGSmlTM2xTTkVWU1RFdzVaR0YwYUc1dVZsSjJhREZQVm1SRE16aEZVVTFJZW5wbVJGbFNWME5xVFZCTU5qVnBaelpPV0hNMU0yaG1TMHhjYm5BNVZqaG9lRGhaVUdSd1UwOVpia3A2VmtVMFIzWkdlbEZMWVZkTWFsbHFjVWxsV21sWlZXWm1lVmN2YWtjelFqQkNNbk16YlhZMWJuWXJhRVZUZFdGY2JqQXJOalZxTVZONGFWQXZTWGQ0Y2t0eU9FSXhVbHBIYlZWclNHcEpXR0o1TlZZNFExVmtWVTFZZDNOak1XcE5ibFUwTW1oNkwxVkZPWFJQUm0xcWMwcGNibXd2ZFc5WmNVNWlRV2ROUWtGQlJVTm5aMFZCVlZFeE1uZDFZMWM1TVhrcmRXZEZTRVZPTkUxeGEwUnZSVGhEWVdWTmVHMTJWSE13ZG1Fd2IxWmpjbmhjYm5JdmMyRk9aR1JUUTBaU01FVjZjMjQxVDFkMUwwOUpaMDVxYlVkUmFIcFVhbVZaVHpaWGFUaEdSSGh4Y2pKTFFtdG1kV1JXVTI5bGRVeHdXbVZSUjBKY2JuTmpNMnczUmxRd2VGVnJWbE5hTmxaeVZDOXZNREJUT0V4b1FVcDJhWEZJTVhveWVISnRTbE5ST1c1a1pIRldOazFaYTI5TlZqQXZaM0ZzTnpOTE1IZGNia2RMWTIxcFpuSnFVelJRWkdOTmQyOWxZVWt6VGtwa2VXWlZOVFZIY1V4VWNXdG9NbTFwUmtOYVVWZFhUV3c1YVVSelIycDBPRmszYWxkWlVuRm5ZazVjYmxad1dITlhSWFJxVm1FMmVWbEVVVzlIYjI1TU1WbzJjVXh6TTNGdGVFUm1hMUIzVUV4aVQwbFFaSEpRZURSbVVGTnhiV05VUlZwalpYZDFZbmxDWVRWY2JqaE9NMWg2UW5SeldWSkRUbGxPUnpaNUswMXJkMDVJVWs1SlJVOHZZaTlKY1RCQmFsSmlZVmd3VVV0Q1oxRkVlbTlhWjJKNE9EQjBXRTl4U200MGFVcGNiazluYVhCWGRXMWxZbHBMWTJaT01YUmxWbEZxZFVGUFMxQkNiMEpKVTFNMGEwaDJkbFJLTmt3NVpYRklXV1ZOZVdneFZUQkRUVU5SYTFOV1ZFUjBVM0JjYm1NNE5EWmlhbk13YjFaNVRYcEVOME5JY0hKak1qQTVhRmRPUW05SGJFdDVjbVJUVjBKVU9XVmFaVWd4ZGt4aVRFSlpUVFUwWjBobFdsbGlObmQ0U1hGY2JteGplamMzYzB0RVpqbG5UREZHVEhnMlJGSXlWMVl5WkRCUlMwSm5VVVJoTTFvNVNtMXBPWEJHVFhOT1pHMU5lRlZFU0RBdlVEQkRabTRyY1Vwd1dWZGNia3QzYW14VGRqUlllRUZPY0hCaVYzWm9NMll3V2sxSlpuSlhiazlhVlV0R05uZFlTbUpDYTFKemEwMXVPV2RuVVdoNUsyNVBNa1pUWlRoSkwwSnFTREpjYmpneFF6QkJNWEZuY3k5UU0yOU9PR05NZHpWNFFYcFdUVU5ZZGtWck5saExibEIyT1ZFNVF6YzJkM2x2TldRMVJ5dDFRMnREYVZsR2JFdG5hVWR2TDB0Y2JqWm9VamxWU2tWa1lYZExRbWRSUTJkRk9YZDVNMHQzYld0NlpWUndOWFkxZEc5VU9HRmllVFJ0VUhoT1JVRnZXbkJUSzNkeVNHRXJMMFpEUm5veldXMWNibEYxUkRjd1pHTlhNVlZVT1VsVll6YzJkMjlFZGpSQ2RsQk1PVTltU2pocmJTc3JNRWR5ZFZORlJHZFZWbmh6YUZKNVUzWXlkbGRyVnpoMlRIRjNaMDVjYmxkUlVXMWpiRzgxZEhreWNETm5OSEJDV0RBNGNXaENZVkpXUmxWTlNtOWxSM2RHZEhjeWNGSktjelJaY2pkRE1FODRUa1YzSzBWelJWRkxRbWRDY0ROY2JsWkZlVGxPVjBJMmIwUmtTR2x4VlhFNGJTdFRja1JJUTBKRlVXRkhSMjlxTWtKaFMwcEJTRkowVTNaM1YzWkZXRFkxZVVaR2NXaHVLM1pTTTJORWVuSmNibVEyTm5OM1RHUlJTRU5xV0Radkt6bEhWR3RoZVVORlIxVkRNelF6VFM5c1EyMTRTMUEwY0ZKWFNEUnZWMUJLTm1scUswZFRUWEZwUm5aS2JHWkdXSE5jYmprNVptWm1TREZOTldsSlEyTm5aVnBVVGt4d1Z6QkhkbWRWYkcxa2REZDBkMWcyU2pSS1NucEJiMGRDUVU1dEswWlNka3hZTjFaSllVVlFPRkIxTTJWY2JreE9XbWxZWmxKeFpXODBTalZaVERaVVIwdGpNVzVpWkhKSGRFbE9VV2wyYWxaTmRIWkZURm8yY1RsMU4wVmlWamRQU1RCR1EzSTNkRGxzZWpaSU9HNWNibkZUV0RkcUszaDRNRXhpT1RZNGRHaFBPRnBGUkROd1VVbEZjM2RSUTI4MU9XOTVTVFJxVEhNclRFaExaRTVuTkdONmRrWnNZalZ0VFhGdE56SkJjMU5jYms1TFFWWnpPWGhWVWtGSmNWSXhabEIyTDJSdlpsUk1XVnh1TFMwdExTMUZUa1FnVUZKSlZrRlVSU0JMUlZrdExTMHRMVnh1SWl3S0lDQWlZMnhwWlc1MFgyVnRZV2xzSWpvZ0ltZGpjaTFoZFhSb0xYSnZRR3M0Y3kxd2JHRjVaM0p2ZFc1a0xUSTFOakV4TXk1cFlXMHVaM05sY25acFkyVmhZMk52ZFc1MExtTnZiU0lzQ2lBZ0ltTnNhV1Z1ZEY5cFpDSTZJQ0l4TVRRMU5ESXpPVGsyT1RnNE5Ea3pPREl3TlRVaUxBb2dJQ0poZFhSb1gzVnlhU0k2SUNKb2RIUndjem92TDJGalkyOTFiblJ6TG1kdmIyZHNaUzVqYjIwdmJ5OXZZWFYwYURJdllYVjBhQ0lzQ2lBZ0luUnZhMlZ1WDNWeWFTSTZJQ0pvZEhSd2N6b3ZMMjloZFhSb01pNW5iMjluYkdWaGNHbHpMbU52YlM5MGIydGxiaUlzQ2lBZ0ltRjFkR2hmY0hKdmRtbGtaWEpmZURVd09WOWpaWEowWDNWeWJDSTZJQ0pvZEhSd2N6b3ZMM2QzZHk1bmIyOW5iR1ZoY0dsekxtTnZiUzl2WVhWMGFESXZkakV2WTJWeWRITWlMQW9nSUNKamJHbGxiblJmZURVd09WOWpaWEowWDNWeWJDSTZJQ0pvZEhSd2N6b3ZMM2QzZHk1bmIyOW5iR1ZoY0dsekxtTnZiUzl5YjJKdmRDOTJNUzl0WlhSaFpHRjBZUzk0TlRBNUwyZGpjaTFoZFhSb0xYSnZKVFF3YXpoekxYQnNZWGxuY205MWJtUXRNalUyTVRFekxtbGhiUzVuYzJWeWRtbGpaV0ZqWTI5MWJuUXVZMjl0SWdwOSJ9fX0=
    kind: Secret
    metadata:
      name: gcr-json-key
      namespace: {{ $ns }}
    type: kubernetes.io/dockerconfigjson
  - apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: admin
      namespace: {{ $ns }}
    imagePullSecrets:
      - name: gcr-json-key
  - apiVersion: rbac.authorization.k8s.io/v1beta1
    kind: RoleBinding
    metadata:
      name: admin
      namespace: {{ $ns }}
    subjects:
      - kind: ServiceAccount
        name: admin
        namespace: {{ $ns }}
    roleRef:
      kind: ClusterRole
      name: admin
      apiGroup: rbac.authorization.k8s.io
  - apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: admin:psp:restricted
      namespace: {{ $ns }}
    subjects:
      - kind: ServiceAccount
        name: admin
        namespace: {{ $ns }}
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: psp:restricted
  {{- end }}
