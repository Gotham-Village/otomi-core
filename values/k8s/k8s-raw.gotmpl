{{- $v := .Environment.Values }}
{{- $t := $v.teamConfig }}
{{- range $team := $t.teams }}
{{- end }}
resources:
  {{- range $ns := $v.k8s.namespaces }}
  - apiVersion: v1
    kind: Namespace
    metadata:
      name: {{ $ns.name }}
      labels:
        name: {{ $ns.name }}
        istio-injection: {{ if $ns | getOrNil "disableIstioInjection" }}disabled{{ else }}enabled{{ end }}
  {{- end }}
  {{- range $team := $t.teams }}
  {{- $ns := printf "team-%s" $team.name }}
  - apiVersion: v1
    kind: Namespace
    metadata:
      name: {{ $ns }}
      labels:
        name: {{ $ns }}
  {{- end }}
  {{- range $ns := list "ingress" "system" }}
  - apiVersion: v1
    data:
      .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL2djci5pbyI6eyJ1c2VybmFtZSI6Il9qc29uX2tleSIsInBhc3N3b3JkIjoie1xuICBcInR5cGVcIjogXCJzZXJ2aWNlX2FjY291bnRcIixcbiAgXCJwcm9qZWN0X2lkXCI6IFwib3RvbWktY2xvdWRcIixcbiAgXCJwcml2YXRlX2tleV9pZFwiOiBcIjU1OTg5N2EzYTNkZjNkOTc3YmM4OGJmMzdhN2M2NjNmMDAzNzg0YzBcIixcbiAgXCJwcml2YXRlX2tleVwiOiBcIi0tLS0tQkVHSU4gUFJJVkFURSBLRVktLS0tLVxcbk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRGZacTc2SmRINTV1QkJcXG5tRUpsTGhtbURBdCs4a3JqbUtUamdBeGg3M2kwLzNqRGlDVzUwb3cydEZqdE5tZXdtWlU4OWRtU0lZYWYzWUNiXFxub0F0a0JqMldPQTM0NnNQaDhWZVRYdmNnR1pmazVML0RvNmlGSkpnOTZEN25IcU0rSVplUjlZK20xNlNXZG45ZFxcbkR5eXhIbnU3Z3hNQkVVazQ2MTBxZ3hmbXlGR1NQZmFBMGQxZkhZaXhCTnZZek44bXpGMXNkQXNIMTl2SmtRL0tcXG5RQUoxN0ZRQ0VLWFB3QlpQSE02NjY1aUNxbUsxb3p0NVltMTYrYzBXaVhyK1RzbFMxU2NrY0lkYnNLTWRUK3N6XFxuZTFCczVpdW1tTFlHRWh2REpOY1BXNE5lM3oycFVxM3J4MmRuWnVjL1MxdEM1Zm5OOXlaSXp5S1dqTXZBcXRWeVxcbngwbFZoT1NCQWdNQkFBRUNnZ0VBQlJyNERDR24xcDJMT09zZlZSVDNSVFR3TTdxcDVtalBDSkJvUnhnMjZhMXBcXG5hSk8xdzlOUWZzSWpEZUtlbFUyWmRMMlpXUHgyR0dJQmpuWlRzQlFHaktLMG1keXFxNUFTR0J0U2V0RUdOWTl4XFxuTDk2ZWV6djlSWU1IWmV0MEZvWm54R2JOTzQrL0dQdkN2eUladEFNNCtYeXgvNXJHd3RjQmJqc2JNS3NvenNXYlxcbnZuUE1oYzY3amdxMzZ2U3J5b1lBMFlwd2V1ZXJzc0lYMVYyWnRVRFB1VXFrYkhLWHo5YUIvUFdIUDRYc0g2OHhcXG5hS3UzNmVlZnBnZys1Q01XdFdYeXdnajRsWkdjV2ZrdTJBbHZMdXhuQ1lRdThpcHh3QVJLTFdMZlUrL0tDcDVhXFxuSWVPRkMwUkU1bnJBMVoyd2hIUHg5Zk5GU1Q4dVR6Ry80WGIrazVYMWxRS0JnUUQxT2VOZlRBYjdaZHB3bUQzRlxcbkEzUGtQYldLVTROaEZ0NXVnK3J5dlIxSHI4cXlXZlcvWDJodzc3elpEdEUvcUZ4S0RzcmQzTW1Ta3dRcnVqaFFcXG5MSUJxdG1ETlJCaW5NdW90TjdQSWpQUlJKNFpPNVBrUEluMGR3V1liUUZZMGx5NURqRzkrM3VkWDI3MnFrMHJVXFxudFNHcmZEMUlGYmtpSjRIUFVUY1pYeVNoSHdLQmdRRHBOMU1YeTg3Q3NSOXlQRWtpbnYzdkFvZTk2eEpUMnE0cVxcblI5akRsVmtTUzlzdUFMRVduN2RGa0JCV1owVmF3dDZIdnVzVE9nREpjc2NldDZEcFFYSlI5R01Jc250RmptQitcXG5wR2hnYmdiUVlxRkZIWUNCWDRFeEQxSHdEMUtpUGtQUmdGOHpDTFlSVTc4ZGUrTGFBVXduV3BKSklzNlIveEJFXFxuU3N4Z2pDMm1Yd0tCZ0VZb243S2VEOGxSSktQZUNwNFpGTWtTRnFSU3JGM1VxeUszUHpyZmZFY01ObE84aFNDUlxcbmJWSVNaTmM4OUFUZ2FEY1A4RjUxVW41SzdZQ05NSnRQZ0JZSHc3NDJZMDlDczlqbi9ObTk2aEJsM0hrcDdVKzFcXG5NRktaQ0Z0M2xySkpKb1ZRNG4xTHpLaElTQVZMU3JkOGN2dWErZlZyc2FIaDU3T21xcnJwaTVORkFvR0JBTGlaXFxuYlRGQnhxaC9FUmdZTmYrc2YrM0hQL0VKZUJsZDJFeHBVR0FJQUZnbUtSaXh2WHJkODNDaGh2ME5nMjFESUdlc1xcbnJHQXNvbURTZEdDUkUxSnUxbkdla3lGWVBaRWlFS2xOczd6WWVwWko2OE5NaGVKaDJWNGU5VW1pcDFMN0hDMWhcXG5nbmxmNU5XMFIydXNHelZhbjQvcTlpM2oya1RmODExTEk1a3NmQm5iQW9HQkFPSVROaGEzajFIMmp3RldNMzVjXFxuenRrLzlVMzI4ekNQZXJwODBZNEpMTEZYQ2NEYXhRendEQnVsR1BEU002NVJPSjBKeUY5RUtlUjd5ZlI1MmJjSlxcbnlhU01rcFNOQXJac0hTb0tRMXllOFY2VStzd0VEeldGYkM5S1ZnakoxazZvZ0kyTjVnSVJQQ0QyWjRRUkZTSkxcXG5LOFlzRHFJMjZWNU9ESjBpQUpJWTlHTFVcXG4tLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tXFxuXCIsXG4gIFwiY2xpZW50X2VtYWlsXCI6IFwiZ2NyLWF1dGgtcm9Ab3RvbWktY2xvdWQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb21cIixcbiAgXCJjbGllbnRfaWRcIjogXCIxMTEwNjkwNDc3ODYwNjc3MDk5MDRcIixcbiAgXCJhdXRoX3VyaVwiOiBcImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoXCIsXG4gIFwidG9rZW5fdXJpXCI6IFwiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW5cIixcbiAgXCJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmxcIjogXCJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHNcIixcbiAgXCJjbGllbnRfeDUwOV9jZXJ0X3VybFwiOiBcImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvZ2NyLWF1dGgtcm8lNDBvdG9taS1jbG91ZC5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbVwiXG59IiwiYXV0aCI6IlgycHpiMjVmYTJWNU9uc0tJQ0FpZEhsd1pTSTZJQ0p6WlhKMmFXTmxYMkZqWTI5MWJuUWlMQW9nSUNKd2NtOXFaV04wWDJsa0lqb2dJbTkwYjIxcExXTnNiM1ZrSWl3S0lDQWljSEpwZG1GMFpWOXJaWGxmYVdRaU9pQWlOVFU1T0RrM1lUTmhNMlJtTTJRNU56ZGlZemc0WW1Zek4yRTNZelkyTTJZd01ETTNPRFJqTUNJc0NpQWdJbkJ5YVhaaGRHVmZhMlY1SWpvZ0lpMHRMUzB0UWtWSFNVNGdVRkpKVmtGVVJTQkxSVmt0TFMwdExWeHVUVWxKUlhablNVSkJSRUZPUW1kcmNXaHJhVWM1ZHpCQ1FWRkZSa0ZCVTBOQ1MyZDNaMmRUYTBGblJVRkJiMGxDUVZGRVpscHhOelpLWkVnMU5YVkNRbHh1YlVWS2JFeG9iVzFFUVhRck9HdHlhbTFMVkdwblFYaG9Oek5wTUM4emFrUnBRMWMxTUc5M01uUkdhblJPYldWM2JWcFZPRGxrYlZOSldXRm1NMWxEWWx4dWIwRjBhMEpxTWxkUFFUTTBObk5RYURoV1pWUllkbU5uUjFwbWF6Vk1MMFJ2Tm1sR1NrcG5PVFpFTjI1SWNVMHJTVnBsVWpsWksyMHhObE5YWkc0NVpGeHVSSGw1ZUVodWRUZG5lRTFDUlZWck5EWXhNSEZuZUdadGVVWkhVMUJtWVVFd1pERm1TRmxwZUVKT2RsbDZUamh0ZWtZeGMyUkJjMGd4T1haS2ExRXZTMXh1VVVGS01UZEdVVU5GUzFoUWQwSmFVRWhOTmpZMk5XbERjVzFMTVc5NmREVlpiVEUySzJNd1YybFljaXRVYzJ4VE1WTmphMk5KWkdKelMwMWtWQ3R6ZWx4dVpURkNjelZwZFcxdFRGbEhSV2gyUkVwT1kxQlhORTVsTTNveWNGVnhNM0o0TW1SdVduVmpMMU14ZEVNMVptNU9PWGxhU1hwNVMxZHFUWFpCY1hSV2VWeHVlREJzVm1oUFUwSkJaMDFDUVVGRlEyZG5SVUZDVW5JMFJFTkhiakZ3TWt4UFQzTm1WbEpVTTFKVVZIZE5OM0Z3TlcxcVVFTktRbTlTZUdjeU5tRXhjRnh1WVVwUE1YYzVUbEZtYzBscVJHVkxaV3hWTWxwa1RESmFWMUI0TWtkSFNVSnFibHBVYzBKUlIycExTekJ0WkhseGNUVkJVMGRDZEZObGRFVkhUbGs1ZUZ4dVREazJaV1Y2ZGpsU1dVMUlXbVYwTUVadldtNTRSMkpPVHpRckwwZFFka04yZVVsYWRFRk5OQ3RZZVhndk5YSkhkM1JqUW1KcWMySk5TM052ZW5OWFlseHVkbTVRVFdoak5qZHFaM0V6Tm5aVGNubHZXVUV3V1hCM1pYVmxjbk56U1ZneFZqSmFkRlZFVUhWVmNXdGlTRXRZZWpsaFFpOVFWMGhRTkZoelNEWTRlRnh1WVV0MU16WmxaV1p3WjJjck5VTk5WM1JYV0hsM1oybzBiRnBIWTFkbWEzVXlRV3gyVEhWNGJrTlpVWFU0YVhCNGQwRlNTMHhYVEdaVkt5OUxRM0ExWVZ4dVNXVlBSa013VWtVMWJuSkJNVm95ZDJoSVVIZzVaazVHVTFRNGRWUjZSeTgwV0dJcmF6VllNV3hSUzBKblVVUXhUMlZPWmxSQllqZGFaSEIzYlVRelJseHVRVE5RYTFCaVYwdFZORTVvUm5RMWRXY3JjbmwyVWpGSWNqaHhlVmRtVnk5WU1taDNOemQ2V2tSMFJTOXhSbmhMUkhOeVpETk5iVk5yZDFGeWRXcG9VVnh1VEVsQ2NYUnRSRTVTUW1sdVRYVnZkRTQzVUVscVVGSlNTalJhVHpWUWExQkpiakJrZDFkWllsRkdXVEJzZVRWRWFrYzVLek4xWkZneU56SnhhekJ5VlZ4dWRGTkhjbVpFTVVsR1ltdHBTalJJVUZWVVkxcFllVk5vU0hkTFFtZFJSSEJPTVUxWWVUZzNRM05TT1hsUVJXdHBibll6ZGtGdlpUazJlRXBVTW5FMGNWeHVVamxxUkd4V2ExTlRPWE4xUVV4RlYyNDNaRVpyUWtKWFdqQldZWGQwTmtoMmRYTlVUMmRFU21OelkyVjBOa1J3VVZoS1VqbEhUVWx6Ym5SR2FtMUNLMXh1Y0Vkb1oySm5ZbEZaY1VaR1NGbERRbGcwUlhoRU1VaDNSREZMYVZCclVGSm5Samg2UTB4WlVsVTNPR1JsSzB4aFFWVjNibGR3U2twSmN6WlNMM2hDUlZ4dVUzTjRaMnBETW0xWWQwdENaMFZaYjI0M1MyVkVPR3hTU2t0UVpVTndORnBHVFd0VFJuRlNVM0pHTTFWeGVVc3pVSHB5Wm1aRlkwMU9iRTg0YUZORFVseHVZbFpKVTFwT1l6ZzVRVlJuWVVSalVEaEdOVEZWYmpWTE4xbERUazFLZEZCblFsbElkemMwTWxrd09VTnpPV3B1TDA1dE9UWm9RbXd6U0d0d04xVXJNVnh1VFVaTFdrTkdkRE5zY2twS1NtOVdVVFJ1TVV4NlMyaEpVMEZXVEZOeVpEaGpkblZoSzJaV2NuTmhTR2cxTjA5dGNYSnljR2sxVGtaQmIwZENRVXhwV2x4dVlsUkdRbmh4YUM5RlVtZFpUbVlyYzJZck0waFFMMFZLWlVKc1pESkZlSEJWUjBGSlFVWm5iVXRTYVhoMldISmtPRE5EYUdoMk1FNW5NakZFU1VkbGMxeHVja2RCYzI5dFJGTmtSME5TUlRGS2RURnVSMlZyZVVaWlVGcEZhVVZMYkU1ek4zcFpaWEJhU2pZNFRrMW9aVXBvTWxZMFpUbFZiV2x3TVV3M1NFTXhhRnh1WjI1c1pqVk9WekJTTW5WelIzcFdZVzQwTDNFNWFUTnFNbXRVWmpneE1VeEpOV3R6WmtKdVlrRnZSMEpCVDBsVVRtaGhNMm94U0RKcWQwWlhUVE0xWTF4dWVuUnJMemxWTXpJNGVrTlFaWEp3T0RCWk5FcE1URVpZUTJORVlYaFJlbmRFUW5Wc1IxQkVVMDAyTlZKUFNqQktlVVk1UlV0bFVqZDVabEkxTW1KalNseHVlV0ZUVFd0d1UwNUJjbHB6U0ZOdlMxRXhlV1U0VmpaVkszTjNSVVI2VjBaaVF6bExWbWRxU2pGck5tOW5TVEpPTldkSlVsQkRSREphTkZGU1JsTktURnh1U3poWmMwUnhTVEkyVmpWUFJFb3dhVUZLU1ZrNVIweFZYRzR0TFMwdExVVk9SQ0JRVWtsV1FWUkZJRXRGV1MwdExTMHRYRzRpTEFvZ0lDSmpiR2xsYm5SZlpXMWhhV3dpT2lBaVoyTnlMV0YxZEdndGNtOUFiM1J2YldrdFkyeHZkV1F1YVdGdExtZHpaWEoyYVdObFlXTmpiM1Z1ZEM1amIyMGlMQW9nSUNKamJHbGxiblJmYVdRaU9pQWlNVEV4TURZNU1EUTNOemcyTURZM056QTVPVEEwSWl3S0lDQWlZWFYwYUY5MWNta2lPaUFpYUhSMGNITTZMeTloWTJOdmRXNTBjeTVuYjI5bmJHVXVZMjl0TDI4dmIyRjFkR2d5TDJGMWRHZ2lMQW9nSUNKMGIydGxibDkxY21raU9pQWlhSFIwY0hNNkx5OXZZWFYwYURJdVoyOXZaMnhsWVhCcGN5NWpiMjB2ZEc5clpXNGlMQW9nSUNKaGRYUm9YM0J5YjNacFpHVnlYM2cxTURsZlkyVnlkRjkxY213aU9pQWlhSFIwY0hNNkx5OTNkM2N1WjI5dloyeGxZWEJwY3k1amIyMHZiMkYxZEdneUwzWXhMMk5sY25Seklpd0tJQ0FpWTJ4cFpXNTBYM2cxTURsZlkyVnlkRjkxY213aU9pQWlhSFIwY0hNNkx5OTNkM2N1WjI5dloyeGxZWEJwY3k1amIyMHZjbTlpYjNRdmRqRXZiV1YwWVdSaGRHRXZlRFV3T1M5blkzSXRZWFYwYUMxeWJ5VTBNRzkwYjIxcExXTnNiM1ZrTG1saGJTNW5jMlZ5ZG1salpXRmpZMjkxYm5RdVkyOXRJZ3A5In19fQ==
    kind: Secret
    metadata:
      name: gcr-json-key
      namespace: {{ $ns }}
    type: kubernetes.io/dockerconfigjson
  - apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: admin
      namespace: {{ $ns }}
    imagePullSecrets:
      - name: gcr-json-key
  - apiVersion: rbac.authorization.k8s.io/v1beta1
    kind: RoleBinding
    metadata:
      name: admin
      namespace: {{ $ns }}
    subjects:
      - kind: ServiceAccount
        name: admin
        namespace: {{ $ns }}
    roleRef:
      kind: ClusterRole
      name: admin
      apiGroup: rbac.authorization.k8s.io
  - apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: admin:psp:restricted
      namespace: {{ $ns }}
    subjects:
      - kind: ServiceAccount
        name: admin
        namespace: {{ $ns }}
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: psp:restricted
  {{- end }}
