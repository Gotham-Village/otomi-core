toolsVersion: 1.1.4
clusters:
  azure:
    host: aks.otomi.cloud
    stages: [dev, demo, prd]
    region: westeurope
  aws:
    host: eks.otomi.cloud
    stages: [dev, demo, prd]
    region: eu-central-1
  google:
    host: gks.otomi.cloud
    stages: [dev, demo, prd]
    region: europe-west4

k8s:
  namespaces:
    - name: ingress
    - name: istio-operator
      disableIstioInjection: true
    - name: knative-serving
    - name: monitoring
    - name: shared
    - name: team-admin

services:
  - name: auth
    svc: oauth2-proxy
    namespace: istio-system
    isAuthProxy: true
  - name: index
    svc: index
    namespace: team-admin
  # - name: dashboard
  #   svc: kubernetes-dashboard
  #   namespace: kube-system
  #   mtls:
  #     policyMode: permissive
  #     gatewayDisabled: true
  - name: loki-private
    svc: loki-headless
    namespace: monitoring
    internal: true # this service is only specified to create an Istio Policy, so not exposed
    mtls:
      policyMode: permissive
  - name: loki
    svc: po-grafana
    host: grafana # this service is only specified to generate an icon on the dashboard that opens grafana's loki view
    namespace: monitoring
    path: /explore?orgId=1&left=%5B"now-1h","now","Loki",%7B%7D,%7B"mode":"Logs"%7D,%7B"ui":%5Btrue,true,true,"none"%5D%7D%5D
  - name: scope
    svc: weave-scope
    namespace: monitoring
    mtls:
      policyMode: permissive
  - name: grafana
    svc: po-grafana
    namespace: monitoring
    mtls:
      policyMode: permissive
      gatewayDisabled: true
  - name: grafana-istio
    svc: grafana
    port: 3000
    logo: istio
    namespace: istio-system
    mtls:
      policyMode: permissive
      gatewayDisabled: true
  - name: prometheus
    svc: po-prometheus
    port: 9090
    namespace: monitoring
    mtls:
      gatewayDisabled: true
  - name: prometheus-istio
    svc: prometheus
    port: 9090
    logo: prometheus
    namespace: istio-system
    mtls:
      gatewayDisabled: true
  - name: alertmanager
    svc: po-alertmanager
    port: 9093
    logo: prometheus
    namespace: monitoring
    mtls:
      gatewayDisabled: true
  - name: kiali
    svc: kiali
    port: 20001
    namespace: istio-system
    mtls:
      gatewayDisabled: true
  - name: tracing
    svc: tracing
    logo: jaeger
    namespace: istio-system
    mtls:
      gatewayDisabled: true
  - name: drone
    svc: drone
    namespace: team-admin
  - name: otomi-api
    namespace: shared
    port: 8080
    svc: otomi-api
    virtual: true

proxies:
  - name: drone
    svc: drone
    namespace: team-admin
    path: /hook

teamConfig:
  services:
    - name: otomi-api
      namespace: shared
      port: 8080
      svc: otomi-api
      virtual: true
    - name: auth
      svc: oauth2-proxy
      namespace: istio-system
      isAuthProxy: true
    - name: index
      svc: index
    - name: loki
      svc: po-grafana
      host: grafana # this service is only specified to generate an icon on the dashboard that opens grafana's loki view
      path: /explore?orgId=1&left=%5B"now-1h","now","Loki",%7B%7D,%7B"mode":"Logs"%7D,%7B"ui":%5Btrue,true,true,"none"%5D%7D%5D
    - name: grafana
      svc: po-grafana
      mtls:
        policyMode: permissive
        gatewayDisabled: true
    - name: prometheus
      svc: po-prometheus
      port: 9090
      mtls:
        # policyMode: permissive
        gatewayDisabled: true
    - name: alertmanager
      svc: po-alertmanager
      port: 9093
      logo: prometheus
      mtls:
        # policyMode: permissive
        gatewayDisabled: true
